<view class="screen room-screen">
  <scroll-view class="room-scroll" scroll-y="true" show-scrollbar="false">
    <view class="room-header">
      <view style="height: {{topInset}}px;"></view>
      <view class="header-row">
        <view class="back" bindtap="goBack">&lt; 返回</view>
        <view class="title-wrap">
          <view class="title">{{roomCode}} 房间</view>
          <view class="sub">{{memberCount}}位成员</view>
        </view>
        <view class="actions"></view>
      </view>

      <view class="my-balance">
        <view>
          <view class="small">我的余额</view>
          <view class="amount {{myBalanceCls}}">{{myBalance}}<text class="yuan">元</text></view>
        </view>
        <view class="settle-btn" bindtap="goSettlement">结算</view>
      </view>
    </view>

    <view class="warning-banner">
      <view class="warning-icon">🔊</view>
      <view class="warning-text">"打牌记账" 不涉及金钱，禁止用于违法行为</view>
      <view class="warning-close" bindtap="closeWarning" wx:if="{{showWarning}}">✕</view>
    </view>

    <view class="note">点击好友头像即可向TA付款</view>

    <view class="member-grid">
      <view class="member-card card" wx:for="{{members}}" wx:key="index" bindtap="{{item.invite ? 'showInviteDialog' : 'onMemberTap'}}" data-index="{{index}}">
        <block wx:if="{{!item.invite}}">
          <view class="avatar" style="background: {{item.color}};">{{item.short}}</view>
          <view class="self-tag" wx:if="{{item.self}}">我</view>
          <view class="member-name">{{item.name}}</view>
          <view class="member-amount {{item.cls}}">{{item.amount}}</view>
        </block>
        <block wx:else>
          <view class="invite-avatar">⊕</view>
          <view class="invite-text">邀请好友</view>
        </block>
      </view>
    </view>

    <view class="section-head">
      <view class="section-title">流水记录</view>
      <view class="section-count">共 {{records.length}} 笔</view>
    </view>

    <view class="record-list">
      <view class="record-item card" wx:for="{{records}}" wx:key="time">
        <view class="record-left">
          <view class="mini-avatar" style="background: {{item.fromColor}};">{{item.fromShort}}</view>
          <view class="record-name">{{item.from}}</view>
          <view class="arrow">→</view>
          <view class="mini-avatar" style="background: {{item.toColor}};">{{item.toShort}}</view>
          <view class="record-name positive">{{item.to}}</view>
        </view>
        <view class="record-right">
          <view class="negative">{{item.amount}}</view>
          <view class="muted">{{item.time}}</view>
        </view>
      </view>
    </view>
  </scroll-view>

  <view class="qr-mask" wx:if="{{showQrPopup}}" bindtap="closeRoomQr">
    <view class="qr-dialog" catchtap="onQrDialogTap">
      <view class="qr-title">邀请好友</view>
      <view class="qr-sub">扫码或转发加入 {{roomCode}} 房间</view>
      <view class="qr-board">
        <image wx:if="{{qrCodeUrl}}" class="qr-image" src="{{qrCodeUrl}}" mode="aspectFit"></image>
        <view wx:else class="qr-loading">加载中...</view>
      </view>
      <view class="qr-tip">长按识别二维码</view>
      <button class="share-btn" open-type="share">转发给好友</button>
      <view class="qr-close" bindtap="closeRoomQr">关闭</view>
    </view>
  </view>
</view>
