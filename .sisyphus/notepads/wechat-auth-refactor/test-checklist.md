# Task 2.1: 完整流程测试清单

## 测试环境准备

1. 打开微信开发者工具
2. 加载项目：`/Users/xhy/WeChatProjects/oneone-xhy`
3. 清除缓存：工具栏 → 清除缓存 → 清除所有缓存
4. 清除本地存储：调试器 → Storage → 删除所有 storage 数据

---

## 测试用例

### ✅ 测试 1: 静默登录
**操作**: 重新编译并打开小程序

**预期结果**:
- [ ] 小程序正常启动，无白屏
- [ ] 控制台无 JavaScript 错误
- [ ] 控制台无 `syncUserProfileFromWechat` 相关错误
- [ ] 网络面板显示 `POST /api/auth/login` 请求成功

**验证命令**:
```javascript
// 在控制台执行
console.log(wx.getStorageSync('token')) // 应有值
console.log(wx.getStorageSync('user'))  // 应有 { userId, nickname, avatarUrl }
```

---

### ✅ 测试 2: 默认昵称显示
**操作**: 点击底部导航栏的"我的"标签

**预期结果**:
- [ ] 页面正常显示
- [ ] 用户昵称显示为"微信用户"（如果是新用户）
- [ ] 头像区域显示默认头像或昵称首字"微"
- [ ] 统计数据正常显示

---

### ✅ 测试 3: 设置菜单
**操作**: 点击右上角的设置按钮（⚙）

**预期结果**:
- [ ] 弹出操作菜单
- [ ] 菜单中**仅显示**"修改昵称"选项
- [ ] **不显示**"同步微信头像昵称"选项

---

### ✅ 测试 4: 修改昵称 - 正常流程
**操作**: 
1. 点击"修改昵称"
2. 输入"测试用户"
3. 点击"确定"

**预期结果**:
- [ ] 弹出输入框，标题为"修改昵称"
- [ ] 输入框显示当前昵称作为占位符
- [ ] 点击确定后，显示 Toast 提示（如果成功）
- [ ] 页面昵称更新为"测试用户"
- [ ] 头像区域的文字更新为"测"

**验证命令**:
```javascript
// 在控制台执行
console.log(wx.getStorageSync('user').nickname) // 应为"测试用户"
```

---

### ✅ 测试 5: 昵称持久化
**操作**: 
1. 关闭小程序（点击开发者工具的"停止"按钮）
2. 重新编译并打开小程序
3. 进入"我的"页面

**预期结果**:
- [ ] 昵称仍然显示为"测试用户"
- [ ] 数据未丢失

---

### ✅ 测试 6: 修改昵称 - 空昵称
**操作**: 
1. 点击设置按钮 → 修改昵称
2. 清空输入框（不输入任何内容）
3. 点击"确定"

**预期结果**:
- [ ] 显示 Toast 提示："昵称不能为空"
- [ ] 昵称未被修改，仍然是"测试用户"

---

### ✅ 测试 7: 修改昵称 - 取消操作
**操作**: 
1. 点击设置按钮 → 修改昵称
2. 输入"新昵称"
3. 点击"取消"

**预期结果**:
- [ ] 输入框关闭
- [ ] 昵称未被修改，仍然是"测试用户"

---

### ✅ 测试 8: 网络错误处理
**操作**: 
1. 在开发者工具中模拟网络断开（工具栏 → 模拟器 → 网络 → 离线）
2. 点击设置按钮 → 修改昵称
3. 输入"离线测试"
4. 点击"确定"

**预期结果**:
- [ ] 显示 Toast 提示："网络异常，请稍后重试"或类似错误信息
- [ ] 昵称未被修改

---

### ✅ 测试 9: 其他页面功能
**操作**: 测试其他页面是否受影响

**预期结果**:
- [ ] 首页（记账页面）正常显示和操作
- [ ] 历史记录页面正常显示
- [ ] 房间内页面正常显示
- [ ] 所有页面无 JavaScript 错误

---

## 代码层面验证

### ✅ 验证 1: 代码搜索
```bash
cd /Users/xhy/WeChatProjects/oneone-xhy
grep -r "syncUserProfileFromWechat" . --exclude-dir=.sisyphus
# 预期输出：无结果

grep -r "同步微信头像昵称" . --exclude-dir=.sisyphus
# 预期输出：无结果
```

### ✅ 验证 2: 语法检查
```bash
cd /Users/xhy/WeChatProjects/oneone-xhy
node --check app.js
node --check pages/profile/profile.js
# 预期输出：无错误
```

---

## 测试结果记录

**测试日期**: ___________  
**测试人员**: ___________  
**测试环境**: 微信开发者工具 v_______

**通过的测试**: _____ / 9  
**失败的测试**: _____

**发现的问题**:
1. 
2. 
3. 

**备注**:


---

## 测试完成后

如果所有测试通过：
1. 在 `.sisyphus/plans/wechat-auth-refactor.md` 中标记 Task 2.1 为完成
2. 更新 `.sisyphus/notepads/wechat-auth-refactor/learnings.md` 记录测试发现
3. 向 Atlas 报告测试结果

如果有测试失败：
1. 记录具体的失败现象和错误信息
2. 向 Atlas 报告，由 Atlas 决定是否需要修复
